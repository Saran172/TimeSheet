@page "/proj"
@attribute [Authorize(Roles = "manager, Developer")]
@using System.Globalization
@using Microsoft.EntityFrameworkCore
@using Task_1.Data
@using Task_1.DbCon
@using Task_1.Model
@using Task_1.Services
@inject ProjectService projectservice
@inject CustomerDbContext _context
@inject CustomerService customerservice
@inject IJSRuntime JS

@if (isLoading)
{
    <div class="rl-loading-container">
        <div class="loader"></div>
    </div>
}
else
{
    <div class="model">
        <div class="toolbar">
            <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#exampleModal" @onclick="AddModel">Add Project</button>
            @*     <button class="grid-toolbar-edit" data-bs-toggle="modal" data-bs-target="#exampleModal" @onclick="EditItem_Click" disabled="@(!EditItemsEnabled)">Edit</button>
        <button class="grid-toolbar-delete"  @onclick="DeleteItem_Click" disabled="@(!EditItemsEnabled)">Delete</button> *@
            <div class="toolbar-group">
                @* <button class="toolbar-button grid-toolbar-column-chooser" @onclick="ColumnChooserItem_Click">Column Chooser</button> *@
                <div class="grid-toolbar-export">
                    Export
                    <div class="export-options">
                        <button class="btn btn-primary" @onclick="ExportCsvItem_Click">To CSV</button>
                        <button class="btn btn-primary" @onclick="ExportXlsxItem_Click">To XLSX</button>
                        <button class="btn btn-primary" @onclick="ExportXlsItem_Click">To XLS</button>
                    </div>
                </div>
            </div>
        </div>


        <DxGrid @ref="Grid"
                Data="Data"
                PageSize="20"
                ShowSearchBox="true"
                CustomizeElement="Grid_CustomizeElement"
                KeyboardNavigationEnabled="Params.KeyboardNavigationEnabled">
            <Columns>
                <DxGridDataColumn FieldName="So_Number" Caption="So Number" DisplayFormat="d"  Width="8%"/>
                <DxGridDataColumn FieldName="So_Date" Caption="So Date" Width="10%" MinWidth="50" DisplayFormat="dd-MM-yyyy" TextAlignment="GridTextAlignment.Right" />
                <DxGridDataColumn FieldName="Cust_Name" Caption="Customer Name" MinWidth="50" SortIndex="0" SortOrder="GridColumnSortOrder.Ascending" TextAlignment="GridTextAlignment.Center" />
                <DxGridDataColumn FieldName="Project_Name" Caption="Project Name" MinWidth="50" />
                <DxGridDataColumn FieldName="DueDate" Caption="Due Date" Width="10%" MinWidth="50" DisplayFormat="dd-MM-yyyy" />
                <DxGridDataColumn FieldName="IsBillable" Caption="Bill Status" MinWidth="20" TextAlignment="GridTextAlignment.Center" />
                <DxGridDataColumn FieldName="Project_Status" Caption="Project Status" MinWidth="50" />
                <DxGridDataColumn FieldName="Proj_Id" Caption="Action" AllowSort="false" width="90px" MinWidth="150" TextAlignment="GridTextAlignment.Center" >

                    <CellDisplayTemplate>
                        <button class="btn btn-outline-warning" data-bs-toggle="modal" data-bs-target="#exampleModal1" @onclick="() => EditPModel((int)context.Value)">Edit</button>
                        @* <button class="btn btn-outline-danger" @onclick="() => ShowDeleteConfirmation((int)context.Value)" data-bs-toggle="modal" data-bs-target="#confirmationModal" title="Delete">Delete</button> *@
                    </CellDisplayTemplate>
                </DxGridDataColumn>

            </Columns>
        </DxGrid>
    </div>
}




<div class="modal fade" id="exampleModal" data-bs-backdrop="static" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">

                
                <h5 class="modal-title" id="exampleModalLabel">Add Project</h5>
               
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">

                
                <div class="mb-3">
                    <label class="col-form-label">Project Name:<span style="color: red">*</span></label>
                    <input type="text" class="form-control" @bind-value=project.Project_Name />
                </div>
                <div class="mb-3">
                    <label class="col-form-label">Customer Code:<span style="color: red">*</span></label>
                    <InputSelect id="customer" @bind-Value="project.Cust_Code" class="form-control">
                                <option value="">---select---</option>
                                @foreach (var cust in lt_customer)
                                {
                                    <option value="@cust.Cust_Code">@cust.Cust_Code - @cust.Cust_Name</option>
                                }
                            </InputSelect>
                </div>
                <div class="mb-3">
                    <label class="col-form-label">Project Status:<span style="color: red">*</span></label>
                    <InputSelect id="stat" @bind-Value=project.Project_Status class="form-control">
                        <option value="">--Select--</option>
                        <option value="Yet To Start">Yet To Start</option>
                        <option value="Work In Progress">Work In Progress</option>
                        <option value="On Hold">On Hold</option>
                        <option value="Completed">Completed</option>
                    </InputSelect>
                </div>
                <div class="mb-3">
                    <label class="col-form-label">Due Date:<span style="color: red">*</span></label>
                    <input type="date" class="form-control" @bind-value=project.DueDate />
                </div>
                <div class="mb-3">
                    <label class="col-form-label">So Number:<span style="color: red">*</span></label>
                    <input type="text" class="form-control" @bind-value=project.So_Number />
                </div>
                <div class="mb-3">
                    <label class="col-form-label">So Date:<span style="color: red">*</span></label>
                    <input type="date" class="form-control" @bind-value=project.So_Date />
                </div>
                <div class="mb-3">
                    <label class="col-form-label">Bill Status:<span style="color: red">*</span></label>
                    <InputSelect id="stat" @bind-Value=project.IsBillable class="form-control">
                        <option value="">--Select--</option>
                        <option value="Billable">Billable</option>
                        <option value="Non-billable">Non-billable</option>
                    </InputSelect>
                </div>
            
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal" @onclick=AddPItem>Save</button>


            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="exampleModal1" data-bs-backdrop="static" tabindex="-1" aria-labelledby="exampleModal1Label" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">

                <h5 class="modal-title" id="exampleModalLabel">Edit Project </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">

                <div class="mb-3">
                    <label class="col-form-label">Project Name:</label>
                    <input type="text" class="form-control" @bind-value=Project_Name />
                </div>
                <div class="mb-3">
                    <label class="col-form-label">Project Status:</label>
                    <InputSelect id="stat" @bind-Value=Project_Status class="form-control">
                        <option value="">--Select--</option>
                        <option value="Yet To Start">Yet To Start</option>
                        <option value="Work In Progress">Work In Progress</option>
                        <option value="On Hold">On Hold</option>
                        <option value="Completed">Completed</option>
                    </InputSelect>
                </div>
                <div class="mb-3">
                    <label class="col-form-label">Customer Code:</label>
                    <InputSelect id="customer" @bind-Value="Cust_Code" class="form-control">
                                <option value="">---select---</option>
                                @foreach (var cust in lt_customer)
                                {
                                    <option value="@cust.Cust_Code">@cust.Cust_Code - @cust.Cust_Name</option>
                                }
                    </InputSelect>
                </div>
                <div class="mb-3">
                    <label class="col-form-label">Due Date:</label>
                    <input type="date" class="form-control" @bind-value=DueDate />
                </div>
                <div class="mb-3">
                    <label class="col-form-label">So Number:</label>
                    <input type="text" class="form-control" @bind-value=So_Number />
                </div>
                <div class="mb-3">
                    <label class="col-form-label">So Date:</label>
                    <input type="date" class="form-control" @bind-value=So_Date />
                </div>
                <div class="mb-3">
                    <label class="col-form-label">Bill Status:</label>
                    <InputSelect id="stat" @bind-Value=isbillable class="form-control">
                        <option value="">--Select--</option>
                        <option value="Billable">Billable</option>
                        <option value="Non-billable">Non-billable</option>
                    </InputSelect>
                </div>
             
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal" @onclick="()=>EditPItem()">Save</button>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="confirmationModal" tabindex="-1" aria-labelledby="confirmationModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmationModalLabel">Confirm Deletion</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this Project?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" data-bs-dismiss="modal" @onclick="ConfirmDelete">Delete</button>
            </div>
        </div>
    </div>
</div>

<footer class="footer">
    <p>Projects</p>
</footer>

@code {
    
}
