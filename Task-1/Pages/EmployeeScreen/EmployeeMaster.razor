@page "/EmployeeMaster"
@attribute [Authorize(Roles = "manager, Developer")]
@using Blazored.Toast.Services
@using Microsoft.AspNetCore.Identity
@using Microsoft.EntityFrameworkCore
@using Task_1.Data
@using Task_1.DbCon
@using Task_1.Model
@using Task_1.Services
@inject EmployeeService employeeservice
@inject CustomerDbContext _context
@inject IToastService ToastService
@inject IJSRuntime JS

@if (isLoading)
{
    <div class="rl-loading-container">
        <div class="loader"></div>
    </div>
}
else
{  

    <div class="model">
        <div class="toolbar">
            <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#exampleModal" @onclick="AddModel">Add Employee</button>
            @*     <button class="grid-toolbar-edit" data-bs-toggle="modal" data-bs-target="#exampleModal" @onclick="EditItem_Click" disabled="@(!EditItemsEnabled)">Edit</button>
        <button class="grid-toolbar-delete"  @onclick="DeleteItem_Click" disabled="@(!EditItemsEnabled)">Delete</button> *@
            
        </div>


        <DxGrid @ref="Grid"
                Data="Data"
                PageSize="14"
                ShowSearchBox="true"
                CustomizeElement="Grid_CustomizeElement"
                KeyboardNavigationEnabled="Params.KeyboardNavigationEnabled">
            <Columns>@* 
                <DxGridDataColumn FieldName="EMP_ID" Caption="EmployeeId" MinWidth="50" /> *@
                <DxGridDataColumn FieldName="EMP_CODE" Caption="Employee Code" MinWidth="50" />
                <DxGridDataColumn FieldName="EMP_NAME" Caption="Employee Name" MinWidth="50" />
                <DxGridDataColumn FieldName="EMP_CONTACTNO" Caption="Contact No." MinWidth="200" />
                <DxGridDataColumn FieldName="EMP_CONTACTMAIL" Caption="Email" MinWidth="200" />
                <DxGridDataColumn FieldName="Role" Caption="Role" MinWidth="50" />
                <DxGridDataColumn FieldName="EMP_DESIGNATION" Caption="Designation" MinWidth="50" />
                <DxGridDataColumn FieldName="EMP_STATUS" Caption="Status" MinWidth="50" TextAlignment="GridTextAlignment.Center" />

                <DxGridDataColumn FieldName="EMP_ID" Caption="Action" AllowSort="false" width="90px" MinWidth="150" TextAlignment="GridTextAlignment.Center">

                    <CellDisplayTemplate>
                        <button class="btn btn-outline-warning" data-bs-toggle="modal" data-bs-target="#exampleModal1" @onclick="() => EditModel((int)context.Value)">Edit</button>
                        @* <button class="btn btn-outline-danger" @onclick="() => ShowDeleteConfirmation((int)context.Value)" data-bs-toggle="modal" data-bs-target="#confirmationModal" title="Delete">Delete</button> *@
                    </CellDisplayTemplate>
                </DxGridDataColumn>

            </Columns>
        </DxGrid>
    </div>

    <div class="modal fade" id="exampleModal" data-bs-backdrop="static" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">

                    <h5 class="modal-title" id="exampleModalLabel">Add Employee</h5>

                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">

                    <div class="mb-3">
                        <label class="col-form-label">Employee Code:</label>
                        <input type="text" class="form-control" @bind-value=employee.EMP_CODE />
                    </div>
                    <div class="mb-3">
                        <label class="col-form-label">Employee Name:</label>
                        <input type="text" class="form-control" @bind-value=employee.EMP_NAME />
                    </div>
                    <div class="mb-3">
                        <label class="col-form-label">ContactNo:</label>
                        <input type="text" class="form-control" @bind-value=employee.EMP_CONTACTNO />
                    </div>
                    <div class="mb-3">
                        <label class="col-form-label">Email ID:</label>
                        <input type="text" class="form-control" @bind-value=employee.EMP_CONTACTMAIL />
                    </div>
                    <div class="mb-3">
                        <label class="col-form-label">Role :</label>
                        <InputSelect id="employee" @bind-Value=employee.Role class="form-control">
                            <option value="select">--Select--</option>
                            <option value="employee">Employee</option>
                            <option value="manager">Manager</option>
                        </InputSelect>
                    </div>
                    <div class="mb-3">
                        <label class="col-form-label">Designation :</label>
                        <div class="input-group">
                            <InputSelect @bind-Value="employee.EMP_DESIGNATION" class="form-control">
                                <option value="select">--Select--</option>
                                @foreach (var des in lt_designations)
                                {
                                    <option value="@des.EmployeeDesignations">@des.EmployeeDesignations</option>
                                }
                            </InputSelect>
                            <button type="button" class="btn btn-primary" @onclick="OpenAddDesignationModal">
                                <i class="bi bi-plus-circle"></i> Add
                            </button>
                        </div>
                        
                    </div>

                    <!-- Modal to Add New Designation -->
                    @if (showAddDesignationModal)
                    {
                        <div class="modal fade show d-block" tabindex="-1" style="background-color: rgba(0,0,0,0.5);">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title">Add New Designation</h5>
                                        <button type="button" class="btn-close" @onclick="CloseAddDesignationModal"></button>
                                    </div>
                                    <div class="modal-body">
                                        <input type="text" class="form-control" placeholder="Enter new designation" @bind="newDesignation" />
                                    </div>
                                    <div class="modal-footer">
                                        <button class="btn btn-secondary" @onclick="CloseAddDesignationModal">Cancel</button>
                                        <button class="btn btn-primary" @onclick="AddDesignation">Save</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }


                    <div class="mb-3">
                        <label class="col-form-label">Reporting Manager:</label>
                        <InputSelect id="Repo" @bind-Value=employee.Reporting_Manager class="form-control">
                            <option value="select">--Select--</option>
                            @foreach (var Rep in lt_reportingmanagers)
                            {
                                <option value="@Rep.EMP_NAME">@Rep.EMP_NAME</option>
                            }
                        </InputSelect>
                    </div>
                    <div class="mb-3">
                        <label class="col-form-label">Employee Status:</label>
                        <InputSelect id="stat" @bind-Value=employee.EMP_STATUS class="form-control">
                            <option value="select">--Select--</option>
                            <option value="Active">Active</option>
                            <option value="InActive">InActive</option>
                        </InputSelect>
                    </div>
                    <div class="mb-3">
                        <label class="col-form-label">Password:</label>
                        <input type="text" class="form-control" @bind-value=employee.EMP_PASSWORD />
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal" @onclick=AddItem>Save</button>
                </div>
            </div>
        </div>

    </div>
    <div class="modal fade" id="exampleModal1" data-bs-backdrop="static" tabindex="-1" aria-labelledby="exampleModal1Label" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">

                    <h5 class="modal-title" id="exampleModalLabel">Edit Employee </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">


                    <div class="mb-3">
                        <label class="col-form-label">Employee Code:</label>
                        <input type="text" class="form-control" @bind-value=EMP_CODE />
                    </div>
                    <div class="mb-3">
                        <label class="col-form-label">Employee Name:</label>
                        <input type="text" class="form-control" @bind-value=EMP_NAME />
                    </div>
                    <div class="mb-3">
                        <label class="col-form-label">ContactNo:</label>
                        <input type="text" class="form-control" @bind-value=EMP_CONTACTNO />
                    </div>
                    <div class="mb-3">
                        <label class="col-form-label">Email ID:</label>
                        <input type="text" class="form-control" @bind-value=EMP_CONTACTMAIL />
                    </div>
                    <div class="mb-3">
                        <label class="col-form-label">Role :</label>
                        <InputSelect id="employee" @bind-Value="Role" class="form-control">
                            <option value="Not selected">--Select--</option>
                            <option value="employee">Employee</option>
                            <option value="manager">Manager</option>
                        </InputSelect>
                    </div>
                    <div class="mb-3">
                        <label class="col-form-label">Designation :</label>
                        <InputSelect @bind-Value="EMP_DESIGNATION" class="form-control">
                            <option value="select">--Select--</option>
                            @foreach (var des in lt_designations)
                            {
                                <option value="@des.EmployeeDesignations">@des.EmployeeDesignations</option>
                            }
                        </InputSelect>
                        @* <InputSelect id="project" @bind-Value="EMP_DESIGNATION" class="form-control">
                            <option value="Not selected">--Select--</option>
                            <option value="Trainee">Trainee</option>
                            <option value="Flutter Developer">Flutter Developer</option>
                            <option value="Dot Net Developer">Dot Net Developer</option>
                            <option value="Social Media Marketing Executive">Social Media Marketing Executive</option>
                            <option value="Business Development Manager">Business Development Manager</option>
                            <option value="Delivery Manager">Delivery Manager</option>
                            <option value="Product Manager">Product Manager</option>
                            <option value="Key Account Manager">Key Account Manager</option>
                            <option value="SAP">SAP</option>
                            <option value="Testing & Support">Testing & Support</option>
                        </InputSelect> *@
                    </div>
                    <div class="mb-3">
                        <label class="col-form-label">Reporting Manager:</label>
                        <InputSelect id="Repo" @bind-Value=Reporting_Manager class="form-control">
                            <option value="select">--Select--</option>
                            @foreach (var Rep in lt_reportingmanagers)
                            {
                                <option value="@Rep.EMP_NAME">@Rep.EMP_NAME</option>
                            }
                        </InputSelect>
                        @* <InputSelect id="Repo"  @bind-Value=Reporting_Manager class="form-control">
                            <option value="select">--Select--</option>
                            <option value="Manikandan">Manikandan</option>
                            <option value="Ramesh">Ramesh</option>
                            <option value="Gopi">Gopinath</option>
                            <option value="Sindhu">Sindhu</option>
                        </InputSelect> *@
                    </div>
                    <div class="mb-3"> 
                        <label class="col-form-label">Employee Status:</label>
                        <InputSelect id="stat" @bind-Value="EMP_STATUS" class="form-control">
                            <option value="select">--Select--</option>
                            <option value="Active">Active</option>
                            <option value="InActive">InActive</option>
                        </InputSelect>
                    </div>
                   @*  <div class="mb-3">
                        <label class="col-form-label">Password:</label>
                        <input type="password" class="form-control" @bind-value=EMP_PASSWORD />
                    </div> *@
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal" @onclick="()=>EditItem()">Save</button>
                </div>
            </div>
        </div>
    </div>
}


<!-- Confirmation Modal -->
<div class="modal fade" id="confirmationModal" tabindex="-1" aria-labelledby="confirmationModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmationModalLabel">Confirm Deletion</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this Employee?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" data-bs-dismiss="modal" @onclick="ConfirmDelete">Delete</button>
            </div>
        </div>
    </div>
</div>


<footer class="footer">
    <p>Employees</p>
</footer>




@code {

    

}