@page "/cust"
@attribute [Authorize(Roles = "manager, Developer")]
@using System.Globalization
@using Microsoft.EntityFrameworkCore
@using Task_1.Data
@using Task_1.DbCon
@using Task_1.Model
@using Task_1.Services
@inject CustomerService customerservice
@inject CustomerDbContext _context
@inject IJSRuntime JS

@if (isLoading)
{
    <div class="rl-loading-container">
        <div class="loader"></div>
    </div>
}
else
{
    <div class="model">
        <div class="toolbar">
            <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#exampleModal" @onclick="AddModel">Add Customer</button>
            <div class="toolbar-group">
                <div class="grid-toolbar-export">
                    Export
                    <div class="export-options">
                        <button class="btn btn-primary" @onclick="ExportCsvItem_Click">To CSV</button>
                        <button class="btn btn-primary" @onclick="ExportXlsxItem_Click">To XLSX</button>
                        <button class="btn btn-primary" @onclick="ExportXlsItem_Click">To XLS</button>
                    </div>
                </div>
            </div>
        </div>


        <DxGrid @ref="Grid"
                Data="Data"
                PageSize="10"
                ShowSearchBox="true"
                CustomizeElement="Grid_CustomizeElement"
                KeyboardNavigationEnabled="Params.KeyboardNavigationEnabled">
            <Columns>
                <DxGridDataColumn FieldName="Cust_Code" Caption="Cust code" MinWidth="50" SortIndex="0" SortOrder="GridColumnSortOrder.Ascending"/>
                <DxGridDataColumn FieldName="Cust_Name" Caption="Customer Name" MinWidth="50" />
                <DxGridDataColumn FieldName="Cust_ContactNo" Caption="Contact Number" MinWidth="50" />
                <DxGridDataColumn FieldName="Cust_Email" Caption="Email Address" MinWidth="200" />
                <DxGridDataColumn FieldName="Cust_Id" Caption="Action" AllowSort="false" width="90px" MinWidth="150" TextAlignment="GridTextAlignment.Center">

                    <CellDisplayTemplate>
                        <button class="btn btn-outline-warning" data-bs-toggle="modal" data-bs-target="#exampleModal1" @onclick="() => EditModel((int)context.Value)">Edit</button>
                        @* <button class="btn btn-outline-danger" @onclick="() => ShowDeleteConfirmation((int)context.Value)" data-bs-toggle="modal" data-bs-target="#confirmationModal" title="Delete">Delete</button> *@
                    </CellDisplayTemplate>
                </DxGridDataColumn>

            </Columns>
        </DxGrid>
    </div>
}



<div class="modal fade" id="exampleModal" data-bs-backdrop="static" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Add Customer</h5>

                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">

                <div class="mb-3">
                    <label class="col-form-label">Customer Code:<span style="color: red">*</span></label>
                    <input type="text" class="form-control" @bind-value=customer.Cust_Code />
                </div>
                <div class="mb-3">
                    <label class="col-form-label">Customer Name:<span style="color: red">*</span></label>
                    <input type="text" class="form-control" @bind-value=customer.Cust_Name />
                </div>
                <div class="mb-3">
                    <label class="col-form-label">Customer ContactNo:</label>
                    <input type="text" class="form-control" @bind-value=customer.Cust_ContactNo />
                </div>
                <div class="mb-3">
                    <label class="col-form-label">Customer Email:</label>
                    <input type="text" class="form-control" @bind-value=customer.Cust_Email />
                </div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
               
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal" @onclick=AddCustomer>Save</button>


            </div>
        </div>
    </div>
    
</div>
<div class="modal fade" id="exampleModal1" data-bs-backdrop="static" tabindex="-1" aria-labelledby="exampleModal1Label" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">

                <h5 class="modal-title" id="exampleModalLabel">Edit Customer </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">


                <div class="mb-3">
                    <label class="col-form-label">Customer Code:<span style="color: red">*</span></label>
                    <input type="text" class="form-control" @bind-value=Cust_Code />
                </div>
                <div class="mb-3">
                    <label class="col-form-label">Customer Name:<span style="color: red">*</span></label>
                    <input type="text" class="form-control" @bind-value=Cust_Name />
                </div>
                <div class="mb-3">
                    <label class="col-form-label">Customer ContactNo:</label>
                    <input type="text" class="form-control" @bind-value=Cust_ContactNo />
                </div>
                <div class="mb-3">
                    <label class="col-form-label">Customer Email:</label>
                    <input type="text" class="form-control" @bind-value=Cust_Email />
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal" @onclick="UpdateCustomer">Save</button>
            </div>
        </div>
    </div>
</div>

<!-- Confirmation Modal -->
<div class="modal fade" id="confirmationModal" tabindex="-1" aria-labelledby="confirmationModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmationModalLabel">Confirm Deletion</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this Customer?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" @onclick="ConfirmDelete">Delete</button>
            </div>
        </div>
    </div>
</div>

<footer class="footer">
    <p>Customers</p>
</footer>

@code {
   
}
